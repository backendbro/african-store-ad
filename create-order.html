<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Admin Dashboard | Create Order</title>

    <script src="js/checkadmin.js"></script>

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link
      href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css"
      rel="stylesheet"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/flowbite@2.5.2/dist/flowbite.min.css"
      rel="stylesheet"
    />

    <style>
      @import url("https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap");

      body {
        font-family: "Inter", sans-serif;
      }

      datalist#foodItemsOptions {
        max-height: 150px;
        overflow-y: auto;
      }
    </style>
  </head>

  <body class="bg-gray-100">
    <div class="flex min-h-screen flex-col md:flex-row">
      <!-- Sidebar -->
      <aside class="w-full border-r bg-white md:w-64">
        <div class="flex h-14 items-center justify-between border-b px-4">
          <a href="/" class="flex items-center gap-2 font-semibold">
            <img src="assest/img/african logo.jpg" alt="" class="" />
          </a>
          <button
            data-drawer-target="default-sidebar"
            data-drawer-toggle="default-sidebar"
            aria-controls="default-sidebar"
            type="button"
            class="inline-flex items-center p-2 mt-2 ms-3 text-sm text-gray-500 rounded-lg lg:hidden hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-200 cusor-pointer"
          >
            <span class="sr-only">Open sidebar</span>
            <svg
              class="w-6 h-6"
              aria-hidden="true"
              fill="currentColor"
              viewBox="0 0 20 20"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                clip-rule="evenodd"
                fill-rule="evenodd"
                d="M2 4.75A.75.75 0 012.75 4h14.5a.75.75 0 010 1.5H2.75A.75.75 0 012 4.75zm0 10.5a.75.75 0 01.75-.75h7.5a.75.75 0 010 1.5h-7.5a.75.75 0 01-.75-.75zM2 10a.75.75 0 01.75-.75h14.5a.75.75 0 010 1.5H2.75A.75.75 0 012 10z"
              ></path>
            </svg>
          </button>
        </div>

        <aside
          id="default-sidebar"
          class="fixed top-0 left-0 z-40 w-64 h-screen transition-transform -translate-x-full sm:translate-x-0 lg:hidden"
          aria-label="Sidebar"
        >
          <div class="h-full px-3 py-4 overflow-y-auto bg-gray-50">
            <nav class="space-y-1.5 p-4 lg:hidden">
              <a
                href="./index.html"
                class="flex items-center gap-3 rounded-lg px-3 py-2 text-gray-500 hover:text-gray-900"
              >
                <i class="ri-home-line"></i>
                Dashboard
              </a>
              <a
                href="./orders-list.html"
                class="flex items-center gap-3 rounded-lg bg-gray-100 px-3 py-2 text-gray-900"
              >
                <i class="ri-shopping-bag-line"></i>
                Orders
              </a>
              <div class="relative">
                <button
                  class="flex w-full items-center gap-3 rounded-lg px-3 py-2 text-gray-500 hover:text-gray-900"
                  onclick="toggleDropdown()"
                >
                  <i class="ri-gift-line"></i>
                  Products
                  <i
                    class="ri-arrow-down-s-line ml-auto transition-transform duration-200"
                    id="dropdownArrow"
                  ></i>
                </button>
                <div class="hidden space-y-1.5 pl-8" id="productsDropdown">
                  <a
                    href="./product-list.html"
                    class="flex items-center gap-3 rounded-lg px-3 py-2 text-gray-500 hover:text-gray-900"
                  >
                    Product List
                  </a>
                  <a
                    href="./add-product.html"
                    class="flex items-center gap-3 rounded-lg px-3 py-2 text-gray-500 hover:text-gray-900"
                  >
                    Add Product
                  </a>
                </div>
              </div>
              <a
                href="/spreadsheet.html"
                class="flex items-center gap-3 rounded-lg px-3 py-2 text-gray-500 hover:text-gray-900"
              >
                <i class="ri-settings-line"></i>
                Spreadsheet
              </a>

              <a
                href="/review.html"
                class="flex items-center gap-3 rounded-lg px-3 py-2 text-gray-500 hover:text-gray-900"
              >
                <i class="ri-mail-line"></i>
                Review
              </a>
              <a
                href="/account.html"
                class="flex items-center gap-3 rounded-lg px-3 py-2 text-gray-500 hover:text-gray-900"
              >
                <i class="ri-login-circle-line"></i>
                Login
              </a>
            </nav>
          </div>
        </aside>

        <nav class="space-y-1.5 p-4 hidden lg:block">
          <a
            href="./index.html"
            class="flex items-center gap-3 rounded-lg px-3 py-2 text-gray-500 hover:text-gray-900"
          >
            <i class="ri-home-line"></i>
            Dashboard
          </a>
          <a
            href="./orders-list.html"
            class="flex items-center gap-3 rounded-lg bg-gray-100 px-3 py-2 text-gray-900"
          >
            <i class="ri-shopping-bag-line"></i>
            Orders
          </a>
          <div class="relative">
            <button
              class="flex w-full items-center gap-3 rounded-lg px-3 py-2 text-gray-500 hover:text-gray-900"
              onclick="toggleDropdown2()"
            >
              <i class="ri-gift-line"></i>
              Products
              <i
                class="ri-arrow-down-s-line ml-auto transition-transform duration-200"
                id="dropdownArrow2"
              ></i>
            </button>
            <div class="hidden space-y-1.5 pl-8" id="productsDropdown2">
              <a
                href="./product-list.html"
                class="flex items-center gap-3 rounded-lg px-3 py-2 text-gray-500 hover:text-gray-900"
              >
                Product List
              </a>
              <a
                href="./add-product.html"
                class="flex items-center gap-3 rounded-lg px-3 py-2 text-gray-500 hover:text-gray-900"
              >
                Add Product
              </a>
            </div>
          </div>
          <a
            href="/spreadsheet.html"
            class="flex items-center gap-3 rounded-lg px-3 py-2 text-gray-500 hover:text-gray-900"
          >
            <i class="ri-settings-line"></i>
            Spreadseet
          </a>
          <a
            href="/review.html"
            class="flex items-center gap-3 rounded-lg px-3 py-2 text-gray-500 hover:text-gray-900"
          >
            <i class="ri-mail-line"></i>
            Review
          </a>
          <a
            href="/account.html"
            class="flex items-center gap-3 rounded-lg px-3 py-2 text-gray-500 hover:text-gray-900"
          >
            <i class="ri-login-circle-line"></i>
            Login
          </a>
        </nav>
      </aside>

      <!-- Main Content -->
      <main class="flex-1">
        <!-- Header -->
        <header
          class="flex h-14 items-center justify-between border-b bg-white px-4 lg:px-8"
        >
          <h2 class="font-semibold hidden lg:flex">Dashboard</h2>
          <form class="flex-1 sm:flex-initial">
            <div class="relative">
              <input
                type="search"
                placeholder="Search by keywords..."
                class="w-full rounded-md border border-gray-300 bg-white px-3 py-2 pr-10 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 sm:w-[300px]"
              />
              <button
                type="submit"
                class="absolute inset-y-0 right-0 flex items-center px-2"
              >
                <i class="ri-search-line text-gray-400"></i>
              </button>
            </div>
          </form>
          <button class="rounded-full p-1 hover:bg-gray-100">
            <img
              src="assest/img/avatar1.jpg"
              alt="Avatar"
              class="h-8 w-8 rounded-full"
            />
          </button>
        </header>

        <div class="p-6">
          <h1 class="text-2xl font-semibold mb-6">Create New Order</h1>

          <!-- Order Form -->
          <form
            id="orderForm"
            class="bg-white shadow-md rounded px-8 pt-6 pb-8 mb-4"
          >
            <!-- Total Amount display in a refined bordered section -->
            <div class="border border-gray-300 rounded-lg p-4 bg-gray-50 mb-6">
              <div
                id="totalAmount"
                class="text-gray-700 text-2xl font-bold mb-4"
              >
                Total Amount: â‚¬0.00
              </div>
              <div class="mb-4">
                <label
                  class="block text-gray-700 text-sm font-bold mb-2"
                  for="foodItems"
                >
                  Food Items
                </label>
                <div id="foodItemsList" class="space-y-2">
                  <!-- Food items will be dynamically inserted here -->
                </div>
                <button
                  type="button"
                  id="addItemBtn"
                  class="mt-2 mb-4 bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline"
                >
                  Add Another Item
                </button>
              </div>
            </div>

            <div class="mb-4">
              <label
                class="block text-gray-700 text-sm font-bold mb-2"
                for="customerName"
              >
                Customer Name
              </label>
              <input
                class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                id="customerName"
                type="text"
                placeholder="Enter customer name"
              />
            </div>

            <div class="mb-4">
              <label
                class="block text-gray-700 text-sm font-bold mb-2"
                for="amountPaid"
              >
                Amount Paid
              </label>
              <input
                class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                id="amountPaid"
                type="number"
                step="0.01"
                placeholder="Enter amount paid"
              />
            </div>

            <div class="mb-4">
              <label
                class="block text-gray-700 text-sm font-bold mb-2"
                for="paymentMethod"
              >
                Payment Method
              </label>
              <select
                class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                id="paymentMethod"
              >
                <option value="cash">Cash</option>
                <option value="transfer">Transfer</option>
                <option value="card">Card</option>
              </select>
            </div>

            <div class="mb-6">
              <label
                class="block text-gray-700 text-sm font-bold mb-2"
                for="orderStatus"
              >
                Order Status
              </label>
              <select
                class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                id="orderStatus"
              >
                <option value="pending">Pending</option>
                <option value="successful">Successful</option>
                <option value="failed">Failed</option>
              </select>
            </div>

            <div class="flex items-center justify-between">
              <button
                class="create-order bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline"
                type="submit"
              >
                Create Order
              </button>
            </div>
          </form>

          <!-- Orders List -->
          <div class="bg-white shadow-md rounded px-8 pt-6 pb-8 mb-4">
            <h2 class="text-xl font-semibold mb-4">Orders List</h2>
            <div class="overflow-x-auto">
              <table class="min-w-full leading-normal">
                <thead>
                  <tr>
                    <th
                      class="px-5 py-3 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider"
                    >
                      Customer / Date
                    </th>
                    <th
                      class="px-5 py-3 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider"
                    >
                      Items
                    </th>
                    <th
                      class="px-5 py-3 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider"
                    >
                      Amount
                    </th>
                    <th
                      class="px-5 py-3 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider"
                    >
                      Payment
                    </th>
                    <th
                      class="px-5 py-3 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider"
                    >
                      Status
                    </th>
                    <th
                      class="px-5 py-3 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider"
                    >
                      Action
                    </th>
                  </tr>
                </thead>
                <tbody id="ordersList">
                  <!-- Orders will be dynamically inserted here -->
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </main>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/flowbite@2.5.2/dist/flowbite.min.js"></script>
    <script>
      function toggleDropdown() {
        console.log("Reacched");
        const dropdown = document.getElementById("productsDropdown");
        const arrow = document.getElementById("dropdownArrow");
        dropdown.classList.toggle("hidden");
        arrow.classList.toggle("rotate-180");
      }
      function toggleDropdown2() {
        console.log("Reacched");
        const dropdown = document.getElementById("productsDropdown2");
        const arrow = document.getElementById("dropdownArrow2");
        dropdown.classList.toggle("hidden");
        arrow.classList.toggle("rotate-180");
      }
    </script>

    <script type="module">
      // Helper functions for localStorage with expiration (24 hours)
      function setLocalOrders(orders) {
        const ordersData = {
          orders: orders,
          expiry: Date.now() + 24 * 60 * 60 * 1000, // 24 hours in milliseconds
        };
        localStorage.setItem("orders", JSON.stringify(ordersData));
      }

      function getLocalOrders() {
        const ordersData = JSON.parse(localStorage.getItem("orders"));
        if (ordersData && ordersData.expiry && Date.now() > ordersData.expiry) {
          console.log("EXPIRED");
          localStorage.removeItem("orders");
          return [];
        }
        return ordersData ? ordersData.orders : [];
      }

      // Fetch the product names from the API
      let productsData = [];
      let foodItems = [];

      // Fetch the product objects from the API.
      fetch("https://african-store.onrender.com/api/v1/product/normal")
        .then((res) => res.json())
        .then((response) => {
          console.log(response.data);
          productsData = response.data; // store full product objects (including price)
          foodItems = productsData.map((product) => product.name);
          console.log("Fetched product names:", foodItems);
          // Initialize form functionality that depends on foodItems.
          initFoodForm();
        })
        .catch((error) => {
          console.error("Error fetching products:", error);
        });

      // Function to initialize food item form functionality
      function initFoodForm() {
        // Create a shared datalist for all food item inputs if it doesn't already exist.
        if (!document.getElementById("foodItemsOptions")) {
          const dataList = document.createElement("datalist");
          dataList.id = "foodItemsOptions";
          dataList.innerHTML = foodItems
            .map((item) => `<option value="${item}">`)
            .join("");
          // Append the datalist to the orderForm (or document.body).
          document.getElementById("orderForm").appendChild(dataList);
        }

        // Add the initial food item element now that foodItems is available.
        document
          .getElementById("foodItemsList")
          .appendChild(createFoodItemElement());

        // Event listener for adding more food item elements.
        document.getElementById("addItemBtn").addEventListener("click", () => {
          document
            .getElementById("foodItemsList")
            .appendChild(createFoodItemElement());
        });

        // Event delegation for remove buttons on food item elements.
        document
          .getElementById("foodItemsList")
          .addEventListener("click", (e) => {
            if (e.target.classList.contains("remove-item")) {
              e.target.closest("div").remove();
            }
          });
      }

      // Function to create a food item element (depends on foodItems)
      // Function to update the total amount display.
      function updateTotalAmount() {
        let total = 0;
        // Select each food item element in the foodItemsList container.
        const foodItemElements = document.querySelectorAll(
          "#foodItemsList > div"
        );
        foodItemElements.forEach((itemDiv) => {
          const quantityInput = itemDiv.querySelector(".quantity");
          const priceInput = itemDiv.querySelector(".price");
          const quantity = parseFloat(quantityInput.value) || 0;
          const price = parseFloat(priceInput.value) || 0;
          total += quantity * price;
        });

        document.getElementById("totalAmount").innerText =
          "Total Amount: $" + total.toFixed(2);
        document.getElementById("amountPaid").value = total.toFixed(2);
      }

      // Function to create a food item element.
      function createFoodItemElement() {
        const itemDiv = document.createElement("div");
        itemDiv.className = "flex items-center space-x-2 mb-2";

        itemDiv.innerHTML = `
    <!-- Input with datalist for searchable/selectable food items -->
    <input list="foodItemsOptions"
           class="food-item shadow appearance-none border rounded py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
           placeholder="Search or select food item">
    
    <!-- Quantity input -->
    <input type="number" class="quantity shadow appearance-none border rounded py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
           placeholder="Quantity" min="1" value="1">
    
    <!-- Price input: read-only so admin cannot modify the price manually -->
    <input type="number" class="price shadow appearance-none border rounded py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
           placeholder="Price" step="0.01" min="0" readonly>
    
    <!-- Product Image Display -->
    <img class="product-image w-40 h-40 object-cover rounded border hidden" src="" alt="Product Image">
    
    <!-- Remove button -->
    <button type="button" class="remove-item bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline">
      Remove
    </button>
  `;

        // Get references to the food item, quantity, price inputs, and image element.
        const foodItemInput = itemDiv.querySelector(".food-item");
        const quantityInput = itemDiv.querySelector(".quantity");
        const priceInput = itemDiv.querySelector(".price");
        const imageEl = itemDiv.querySelector(".product-image");

        // Listen for input events on the food item input.
        foodItemInput.addEventListener("input", () => {
          const selectedValue = foodItemInput.value;
          const product = productsData.find(
            (p) => p.name.toLowerCase() === selectedValue.toLowerCase()
          );

          if (product) {
            console.log(product);

            function calculateFinalPrice(basePrice, discount, discountType) {
              let finalPrice = basePrice;
              if (discountType === "Percentage") {
                finalPrice = basePrice - (basePrice * discount) / 100;
              } else if (discountType === "Fixed Amount") {
                finalPrice = basePrice - discount;
              }
              return finalPrice > 0 ? finalPrice : 0; // Ensure final price is not negative
            }

            const finalPrice = calculateFinalPrice(
              product.BasePrice,
              product.Discount,
              product.DiscountType
            );

            priceInput.value = parseFloat(finalPrice).toFixed(2);

            // Set quantity to 1 for a head start.
            quantityInput.value = 1;

            // Update and show image. Assume product.file[0] holds the image URL.
            const imageUrl = product.file[0] || "";
            if (imageUrl) {
              imageEl.src = imageUrl;
              imageEl.alt = product.name;
              imageEl.classList.remove("hidden"); // Show image
            } else {
              imageEl.src = "";
              imageEl.alt = "Product Image";
              imageEl.classList.add("hidden"); // Hide if no image
            }
          } else {
            priceInput.value = "";
            imageEl.src = "";
            imageEl.alt = "Product Image";
            imageEl.classList.add("hidden"); // Hide if product not found
          }
          // Recalculate total amount when a food item selection is made.
          updateTotalAmount();
        });

        // Listen for changes in the quantity input.
        quantityInput.addEventListener("input", () => {
          updateTotalAmount();
        });

        return itemDiv;
      }

      // Example: When removing an item via event delegation, recalc total.
      document
        .getElementById("foodItemsList")
        .addEventListener("click", (e) => {
          if (e.target.classList.contains("remove-item")) {
            e.target.closest("div").remove();
            updateTotalAmount();
          }
        });

      // Get orders from localStorage using our helper (with expiry)
      let orders = getLocalOrders();

      // Order creation & rendering code
      document
        .getElementById("orderForm")
        .addEventListener("submit", async function (e) {
          e.preventDefault();

          const spinnerNode = document.createElement("p");
          spinnerNode.className = "spin";
          spinnerNode.textContent = "...";
          document.querySelector(".create-order").append(spinnerNode);

          const customer_name =
            document.getElementById("customerName").value.trim() || "None";
          const amount_paid = parseFloat(
            document.getElementById("amountPaid").value
          );
          const payment_method = document.getElementById("paymentMethod").value;
          const order_status = document.getElementById("orderStatus").value;

          // Get order items
          const order_items = [];
          const foodItemsList = document.getElementById("foodItemsList");

          // Loop through each dynamically added food item element.
          Array.from(foodItemsList.children).forEach((itemElement) => {
            const foodSelect = itemElement.querySelector(".food-item");
            const quantityInput = itemElement.querySelector(".quantity");
            const priceInput = itemElement.querySelector(".price");

            if (foodSelect && quantityInput && priceInput) {
              const food_name = foodSelect.value;
              const quantity = parseInt(quantityInput.value, 10);
              const price = parseFloat(priceInput.value);

              if (food_name && !isNaN(quantity) && !isNaN(price)) {
                order_items.push({ food_name, quantity, price });
              } else {
                Swal.fire({
                  title: "Create order",
                  text: "Cross check your values. Make sure you are entering valid values",
                  icon: "error",
                  showConfirmButton: false,
                  timer: 2000,
                });
              }
            }
          });

          const newOrder = {
            customer_name,
            amount_paid,
            payment_method,
            order_status,
            order_items,
          };

          console.log(`This is the neworder: ${JSON.stringify(newOrder)}`);

          const createOrderResponse = await fetch(
            `https://african-store.onrender.com/api/v1/order`,
            {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
                Authorization: `Bearer ${localStorage.getItem("token")}`,
              },
              body: JSON.stringify(newOrder),
            }
          );

          spinnerNode.remove();

          if (createOrderResponse.ok) {
            Swal.fire({
              title: "Create order",
              text: "Order created",
              icon: "success",
              showConfirmButton: false,
              timer: 2000,
            });
          } else {
            Swal.fire({
              title: "Create order",
              text: "Order could not be created",
              icon: "error",
              showConfirmButton: false,
              timer: 2000,
            });
          }

          const responseData = await createOrderResponse.json();
          const { order } = responseData;
          console.log("Order created:", order);

          // Add new order to the orders array and update localStorage with expiry
          orders.push(order);
          setLocalOrders(orders);

          renderOrders();
          this.reset();
          document.getElementById("foodItemsList").innerHTML = "";
          document
            .getElementById("foodItemsList")
            .appendChild(createFoodItemElement());
        });

      // Function to render orders from localStorage
      function renderOrders() {
        const ordersList = document.getElementById("ordersList");
        ordersList.innerHTML = "";

        console.log(orders);
        orders.forEach((order) => {
          console.log(order);
          const row = document.createElement("tr");

          row.innerHTML = `
      <td class="px-5 py-5 border-b border-gray-200 bg-white text-sm">
        <p class="text-gray-900 whitespace-no-wrap">${order.customer_name}</p>
        <p class="text-gray-600 whitespace-no-wrap">${
          order.createdAt ? new Date(order.createdAt).toLocaleString() : ""
        }</p>
      </td>
      <td class="px-5 py-5 border-b border-gray-200 bg-white text-sm">
        <ul class="list-disc pl-5">
          ${order.order_items
            .map(
              (item) =>
                `<li>${item.food_name} - Quantity: ${
                  item.quantity
                }, Price: $${parseFloat(item.price).toFixed(2)}</li>`
            )
            .join("")}
        </ul>
      </td>
      <td class="px-5 py-5 border-b border-gray-200 bg-white text-sm">
        <p class="text-gray-900 whitespace-no-wrap">$${parseFloat(
          order.amount_paid
        ).toFixed(2)}</p>
      </td>
      <td class="px-5 py-5 border-b border-gray-200 bg-white text-sm">
        <p class="text-gray-900 whitespace-no-wrap">${order.payment_method}</p>
      </td>
      <td class="px-5 py-5 border-b border-gray-200 bg-white text-sm">
        <span class="relative inline-block px-3 py-1 font-semibold text-green-900 leading-tight">
          <span aria-hidden class="absolute inset-0 bg-${
            order.order_status === "successful"
              ? "green"
              : order.order_status === "pending"
              ? "yellow"
              : "red"
          }-200 opacity-50 rounded-full"></span>
          <span class="relative">${order.order_status}</span>
        </span>
      </td>
      <td class="px-5 py-5 border-b border-gray-200 bg-white text-sm">
        <button data-id="${
          order._id
        }" class="delete-order bg-red-500 hover:bg-red-700 text-white font-bold py-1 px-2 rounded focus:outline-none focus:shadow-outline">
          Delete
        </button>
      </td>
    `;
          ordersList.appendChild(row);
        });
      }

      // Deletion via event delegation on the orders container.
      document
        .getElementById("ordersList")
        .addEventListener("click", async function (e) {
          const deleteButton = e.target.closest(".delete-order");
          if (!deleteButton) return;
          e.preventDefault();

          const orderId = deleteButton.getAttribute("data-id");
          console.log("Delete order with id:", orderId);

          if (!confirm("Are you sure you want to delete this order?")) {
            return;
          }

          const originalContent = deleteButton.innerHTML;
          deleteButton.innerHTML = `<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true">Deleting</span>`;
          deleteButton.disabled = true;

          try {
            const response = await fetch(
              `https://african-store.onrender.com/api/v1/order/${orderId}`,
              {
                method: "DELETE",
                headers: {
                  Authorization: `Bearer ${localStorage.getItem("token")}`,
                },
              }
            );

            if (!response.ok) {
              Swal.fire({
                title: "Delete order",
                text: "Delete order failed",
                icon: "error",
                showConfirmButton: false,
                timer: 2000,
              });
              throw new Error(`Delete failed with status ${response.status}`);
            }

            // Remove order from local orders array and update localStorage
            const index = orders.findIndex((order) => order._id === orderId);
            if (index !== -1) {
              orders.splice(index, 1);
              setLocalOrders(orders);
              Swal.fire({
                title: "Delete order",
                text: "Delete order successful",
                icon: "success",
                showConfirmButton: false,
                timer: 2000,
              });
            }
            renderOrders();
          } catch (error) {
            console.error("Error deleting order:", error);
            alert("Failed to delete the order. Please try again.");
            deleteButton.innerHTML = originalContent;
            deleteButton.disabled = false;
          }
        });

      // Additional dropdown toggle functions if needed
      function toggleDropdown() {
        const dropdown = document.getElementById("productsDropdown");
        const arrow = document.getElementById("dropdownArrow");
        dropdown.classList.toggle("hidden");
        arrow.classList.toggle("rotate-180");
      }

      function toggleDropdown2() {
        const dropdown = document.getElementById("productsDropdown2");
        const arrow = document.getElementById("dropdownArrow2");
        dropdown.classList.toggle("hidden");
        arrow.classList.toggle("rotate-180");
      }

      // Render orders from localStorage on page load
      renderOrders();
    </script>
  </body>
</html>
